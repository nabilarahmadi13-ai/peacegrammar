<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise - Grammar Peace</title>
    <style>
        :root {
            --bg-color: #0a0e14;
            --card-bg: #161b22;
            --text-main: #c9d1d9;
            --accent: #58a6ff;
            --success: #2ea043;
            --error: #da3633;
            --border: #30363d;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        .top-nav {
            width: 100%;
            max-width: 750px;
            margin-bottom: 15px;
            display: flex;
            justify-content: flex-start;
        }

        .btn-back {
            background: var(--card-bg);
            color: var(--text-main);
            border: 1px solid var(--border);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .btn-back:hover { background: #30363d; border-color: var(--accent); }

        #quiz-wrapper {
            background: var(--card-bg);
            max-width: 750px;
            width: 100%;
            padding: 35px;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .header h1 { font-size: 1.4rem; color: var(--accent); margin: 0; text-transform: uppercase; }
        #timer { font-family: monospace; font-size: 1.2rem; color: #ffa657; }

        .progress-container { height: 4px; background: #21262d; margin-bottom: 25px; }
        #progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        .question-box { margin-bottom: 30px; }
        .question-text { font-size: 1.2rem; margin-bottom: 20px; line-height: 1.5; }

        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }

        .opt-btn {
            background: #21262d;
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 15px 20px;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: 0.2s;
        }

        .opt-btn:hover:not(:disabled) { background: #30363d; border-color: #8b949e; }
        .opt-btn.correct { background: var(--success) !important; color: white; }
        .opt-btn.wrong { background: var(--error) !important; color: white; }

        #feedback-panel {
            margin-top: 20px;
            padding: 20px;
            border-radius: 6px;
            background: #0d1117;
            border-left: 4px solid var(--accent);
            display: none;
        }

        .feedback-exp { font-size: 0.95rem; color: #8b949e; margin-top: 8px; }

        .btn-nav {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            float: right;
            margin-top: 20px;
            display: none;
        }

        #results { display: none; text-align: center; }
        .score-circle { font-size: 3rem; color: var(--accent); margin: 20px 0; }
    </style>
</head>
<body>

<div class="top-nav">
    <button class="btn-back" onclick="window.location.href='../index.html'">
        üè† Back to Levels
    </button>
</div>

<div id="quiz-wrapper">
    <div id="main-quiz">
        <div class="header">
            <h1 id="display-topic">TOPIC NAME</h1>
            <div id="timer">05:00</div>
        </div>

        <div class="progress-container"><div id="progress-bar"></div></div>

        <div class="question-box">
            <div id="q-text" class="question-text"></div>
            <div id="options" class="options-grid"></div>
        </div>

        <div id="feedback-panel">
            <div id="feedback-status" style="font-weight:bold"></div>
            <div id="feedback-desc" class="feedback-exp"></div>
        </div>

        <button id="next-btn" class="btn-nav" onclick="goNext()">NEXT QUESTION</button>
    </div>

    <div id="results">
        <h1>EXAM COMPLETE</h1>
        <div class="score-circle" id="final-score">0/0</div>
        <p id="rank-msg" style="margin-bottom: 20px;"></p>
        <p style="color: var(--accent); font-size: 0.9rem;">Redirecting to Performance Report...</p>
    </div>
</div>

<script src="../app.js"></script>

<script>
    const TOPIC_TITLE = "Degree of Comparison (Fill Blank)"; 
    const TOPIC_KEY = "comparison blank"; 
    const TIME_LIMIT = 600; 
    const TOTAL_TO_SHOW = 20; 

    const pool = [
    { 
        q: "The more complex the mathematical problem _____, the longer it takes to solve.",
        o: ["is", "it is", "be", "being"],
        c: 1,
        e: "Double Comparative structure: 'The + comparative + S + V, the + comparative + S + V'.",
        t: "üí° Pola ini selalu membutuhkan subjek dan kata kerja setelah kata sifat.",
        m: "‚ö†Ô∏è Jangan hilangkan subjek 'it' di klausa pertama."
    },
    { 
        q: "The climate of Indonesia is much more humid than _____ of Saudi Arabia.",
        o: ["that", "those", "this", "it"],
        c: 0,
        e: "Parallel Comparison. 'That' menggantikan kata benda tunggal (climate) untuk menghindari pengulangan.",
        t: "üí° Gunakan 'that' untuk benda tunggal, 'those' untuk jamak.",
        m: "‚ö†Ô∏è Sering salah menggunakan 'it' atau langsung membandingkan 'Indonesia' dengan 'Saudi Arabia'."
    },
    { 
        q: "In the 100-meter sprint, James proved to be _____ of the two athletes.",
        o: ["fastest", "the fastest", "faster", "the faster"],
        c: 3,
        e: "Comparison of Two. Jika hanya membandingkan dua orang/benda, gunakan 'the + comparative'.",
        t: "üí° Of the two -> The faster (bukan the fastest).",
        m: "‚ö†Ô∏è Superlative (-est) hanya untuk perbandingan lebih dari dua."
    },
    { 
        q: "Many researchers believe that synthetic diamonds are superior _____ natural ones in industrial applications.",
        o: ["than", "to", "from", "as"],
        c: 1,
        e: "Special Adjectives. Kata sifat berakhiran -ior (superior, inferior, senior, junior) menggunakan 'to' bukan 'than'.",
        t: "üí° Superior to, Inferior to, Preferable to.",
        m: "‚ö†Ô∏è Kesalahan paling umum adalah menggunakan 'than' karena terbiasa dengan pola comparative."
    },
    { 
        q: "The new skyscraper is _____ any other building in the financial district.",
        o: ["taller than", "the tallest", "as tall as", "tallest of"],
        c: 0,
        e: "Comparison with 'any other'. Digunakan untuk membandingkan satu benda dengan seluruh anggota kelompoknya secara tunggal.",
        t: "üí° Comparative + than any other + Singular Noun.",
        m: "‚ö†Ô∏è Jika menggunakan Superlative, pola yang benar adalah 'the tallest of all buildings'."
    },
    { 
        q: "The current economic crisis is far _____ than the one we experienced a decade ago.",
        o: ["worse", "worst", "badder", "bad"],
        c: 0,
        e: "Irregular Comparative. Bad -> Worse -> Worst.",
        t: "üí° Gunakan 'far' atau 'much' untuk memberi penekanan pada comparative.",
        m: "‚ö†Ô∏è 'Badder' tidak ada dalam bahasa Inggris formal."
    },
    { 
        q: "This laptop is not _____ as the one I saw at the electronics trade show.",
        o: ["so efficient", "more efficient", "efficient", "as efficient"],
        c: 3,
        e: "Comparison of Equality. Pola standar adalah 'as + adjective + as'.",
        t: "üí° Dalam kalimat negatif, 'not as... as' atau 'not so... as' keduanya benar.",
        m: "‚ö†Ô∏è Jangan hilangkan 'as' yang kedua."
    },
    { 
        q: "Gold is _____ of all known metals in the history of human civilization.",
        o: ["most precious", "the most precious", "preciouser", "more precious"],
        c: 1,
        e: "Superlative Degree. Digunakan untuk membandingkan satu benda di dalam seluruh kelompoknya (of all).",
        t: "üí° Selalu gunakan 'the' sebelum 'most' atau bentuk '-est'.",
        m: "‚ö†Ô∏è 'Precious' memiliki lebih dari dua suku kata, harus menggunakan 'most'."
    },
    { 
        q: "To many modern consumers, digital books are preferable _____ traditional paperbacks.",
        o: ["than", "to", "as", "from"],
        c: 1,
        e: "Preferable. Sama seperti superior, kata 'preferable' dan 'prefer' membutuhkan preposisi 'to'.",
        t: "üí° Prefer A to B. Preferable to.",
        m: "‚ö†Ô∏è Jangan terjebak menggunakan 'than'."
    },
    { 
        q: "Of the three candidates interviewed today, Michael is definitely _____.",
        o: ["the more qualified", "most qualified", "the most qualified", "more qualified"],
        c: 2,
        e: "Superlative for Three. Karena ada 'three candidates', kita harus menggunakan bentuk superlative.",
        t: "üí° Of the three -> Superlative. Of the two -> Comparative.",
        m: "‚ö†Ô∏è Lupa menambahkan artikel 'the'."
    },
    { 
        q: "The higher the altitude of a mountain, _____ oxygen is available for climbers.",
        o: ["the less", "less", "the least", "the little"],
        c: 0,
        e: "Double Comparative. 'The higher... the less...'. Oxygen adalah uncountable noun, jadi gunakan 'less'.",
        t: "üí° The + Comparative, the + Comparative.",
        m: "‚ö†Ô∏è Jangan gunakan 'fewer' untuk benda yang tidak dapat dihitung (oxygen)."
    },
    { 
        q: "This software update is twice _____ than the previous version.",
        o: ["more effective", "as effective", "as effectively", "most effective"],
        c: 1,
        e: "Multiple Comparison. Pola: 'Multiple (twice, three times) + as + adj + as'.",
        t: "üí° Jangan gunakan 'more' jika sudah ada kata 'twice/three times'.",
        m: "‚ö†Ô∏è Sering tertukar menjadi 'twice more effective than' yang tidak baku dalam TOEFL."
    },
    { 
        q: "Her results are not as impressive as _____.",
        o: ["him", "his", "he", "he is"],
        c: 1,
        e: "Parallel Comparison. Membandingkan 'results' (miliknya) dengan 'results' (milik dia laki-laki). 'His' di sini adalah possessive pronoun.",
        t: "üí° Results vs Results (His = His results).",
        m: "‚ö†Ô∏è Jangan membandingkan 'results' dengan 'him' (orang)."
    },
    { 
        q: "This is _____ interesting novel I have ever read in my entire life.",
        o: ["most", "the more", "the most", "more"],
        c: 2,
        e: "Superlative with 'Ever'. Kalimat yang menggunakan 'I have ever...' biasanya membutuhkan superlative.",
        t: "üí° The + Most + Adj + S + have ever + V3.",
        m: "‚ö†Ô∏è Menghilangkan 'the' di depan 'most'."
    },
    { 
        q: "The blue whale is _____ animal known to have ever lived on Earth.",
        o: ["the largest", "largest", "the larger", "larger than"],
        c: 0,
        e: "Superlative. Membandingkan paus biru dengan semua hewan yang pernah ada.",
        t: "üí° Gunakan '-est' untuk kata sifat pendek (1 suku kata).",
        m: "‚ö†Ô∏è Lupa menambahkan 'the'."
    },
    { 
        q: "The engine runs _____ now that we have replaced the faulty spark plugs.",
        o: ["more smooth", "smoothlier", "more smoothly", "the smoothest"],
        c: 2,
        e: "Comparative Adverb. 'Runs' adalah verb, jadi butuh adverb 'smoothly'. Bentuk comparativenya adalah 'more smoothly'.",
        t: "üí° Verb + Adverb (ending -ly).",
        m: "‚ö†Ô∏è Menggunakan 'more smooth' (adjective) untuk menjelaskan 'runs' (verb)."
    },
    { 
        q: "Of all the provinces in the region, South Kalimantan is _____.",
        o: ["the wealthiest", "wealthier", "more wealthy", "the wealthier"],
        c: 0,
        e: "Superlative. 'Of all' menandakan perbandingan di dalam kelompok besar.",
        t: "üí°wealthy -> wealthiest.",
        m: "‚ö†Ô∏è Tertukar dengan comparative 'wealthier'."
    },
    { 
        q: "It is often said that the pen is _____ the sword.",
        o: ["more mightier than", "mightier than", "mightiest than", "more mighty than"],
        c: 1,
        e: "Comparative. Mighty -> Mightier. Jangan gunakan 'more' jika sudah menggunakan akhiran '-er'.",
        t: "üí° No double comparatives (more better/more mightier).",
        m: "‚ö†Ô∏è Menggunakan 'more mightier' adalah redundan."
    },
    { 
        q: "Your presentation was _____ better than mine because you included more data.",
        o: ["far", "much", "very", "Both A and B"],
        c: 3,
        e: "Intensifiers. 'Far' dan 'Much' bisa digunakan untuk memperkuat comparative.",
        t: "üí° Far/Much better (Boleh). Very better (Salah).",
        m: "‚ö†Ô∏è 'Very' tidak boleh diikuti oleh comparative degree."
    },
    { 
        q: "The newer model is not _____ as expensive as we originally anticipated.",
        o: ["quite", "so", "more", "nearly"],
        c: 3,
        e: "Adverbs in comparison. 'Not nearly as... as' adalah ekspresi umum untuk menunjukkan perbedaan yang besar.",
        t: "üí° nearly/quite/almost bisa diletakkan sebelum 'as...as'.",
        m: "‚ö†Ô∏è Sering memilih 'more' padahal sudah ada struktur 'as...as'."
    }
];

    let currentQuestions = [];
    let currentIdx = 0;
    let score = 0;
    let timer;
    let timeLeft = TIME_LIMIT;
    let answered = false;

    function init() {
        document.getElementById('display-topic').innerText = TOPIC_TITLE;
        currentQuestions = pool.sort(() => 0.5 - Math.random()).slice(0, TOTAL_TO_SHOW);
        startTimer();
        showQuestion();
    }

    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if(timeLeft <= 0) finish();
        }, 1000);
    }

    function showQuestion() {
        answered = false;
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-panel').style.display = 'none';
        const q = currentQuestions[currentIdx];
        
        document.getElementById('progress-bar').style.width = (currentIdx / TOTAL_TO_SHOW * 100) + "%";
        document.getElementById('q-text').innerText = `${currentIdx + 1}. ${q.q}`;
        
        const opts = document.getElementById('options');
        opts.innerHTML = '';
        q.o.forEach((o, i) => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = o;
            b.onclick = () => check(i, b);
            opts.appendChild(b);
        });
    }

    function check(idx, btn) {
        if(answered) return;
        answered = true;
        const q = currentQuestions[currentIdx];
        const all = document.querySelectorAll('.opt-btn');

        if(idx === q.c) {
            score++;
            btn.classList.add('correct');
            showFeedback("CORRECT", q.e, q.t, q.m);
        } else {
            btn.classList.add('wrong');
            all[q.c].classList.add('correct');
            showFeedback("INCORRECT", q.e, q.t, q.m);
        }
        document.getElementById('next-btn').style.display = 'block';
    }

    function showFeedback(status, text, tip, misc) {
        const p = document.getElementById('feedback-panel');
        document.getElementById('feedback-status').innerText = status;
        document.getElementById('feedback-status').style.color = (status === "CORRECT") ? "var(--success)" : "var(--error)";
        document.getElementById('feedback-desc').innerHTML = `${text}<br><br><span style="color:#58a6ff">${tip}</span><br><span style="color:#ffa657">${misc}</span>`;
        p.style.display = 'block';
    }

    function goNext() {
        currentIdx++;
        if(currentIdx < TOTAL_TO_SHOW) showQuestion();
        else finish();
    }

    function finish() {
        clearInterval(timer);
        document.getElementById('main-quiz').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}/${TOTAL_TO_SHOW}`;
        
        let msg = "";
        let grade = "";
        let percent = Math.round((score / TOTAL_TO_SHOW) * 100);

        if(percent >= 85) { msg = "Excellent Work! Mastery Achieved."; grade = "A"; }
        else if(percent >= 70) { msg = "Good Job! A bit more practice and you'll be perfect."; grade = "B"; }
        else { msg = "Keep Practicing. Review the explanations to improve."; grade = "C"; }
        
        document.getElementById('rank-msg').innerText = msg;

        setTimeout(() => {
            if (typeof finishQuiz === "function") {
                finishQuiz(percent, score, TOTAL_TO_SHOW, grade, msg, TOPIC_KEY);
            }
        }, 3000); 
    }

    init();
</script>
</body>
</html>