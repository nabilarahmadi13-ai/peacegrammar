<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise - Grammar Peace</title>
    <style>
        :root {
            --bg-color: #0a0e14;
            --card-bg: #161b22;
            --text-main: #c9d1d9;
            --accent: #58a6ff;
            --success: #2ea043;
            --error: #da3633;
            --border: #30363d;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        .top-nav {
            width: 100%;
            max-width: 750px;
            margin-bottom: 15px;
            display: flex;
            justify-content: flex-start;
        }

        .btn-back {
            background: var(--card-bg);
            color: var(--text-main);
            border: 1px solid var(--border);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .btn-back:hover { background: #30363d; border-color: var(--accent); }

        #quiz-wrapper {
            background: var(--card-bg);
            max-width: 750px;
            width: 100%;
            padding: 35px;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .header h1 { font-size: 1.4rem; color: var(--accent); margin: 0; text-transform: uppercase; }
        #timer { font-family: monospace; font-size: 1.2rem; color: #ffa657; }

        .progress-container { height: 4px; background: #21262d; margin-bottom: 25px; }
        #progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        .question-box { margin-bottom: 30px; }
        .question-text { font-size: 1.2rem; margin-bottom: 20px; line-height: 1.5; }

        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }

        .opt-btn {
            background: #21262d;
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 15px 20px;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: 0.2s;
        }

        .opt-btn:hover:not(:disabled) { background: #30363d; border-color: #8b949e; }
        .opt-btn.correct { background: var(--success) !important; color: white; }
        .opt-btn.wrong { background: var(--error) !important; color: white; }

        #feedback-panel {
            margin-top: 20px;
            padding: 20px;
            border-radius: 6px;
            background: #0d1117;
            border-left: 4px solid var(--accent);
            display: none;
        }

        .feedback-exp { font-size: 0.95rem; color: #8b949e; margin-top: 8px; }

        .btn-nav {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            float: right;
            margin-top: 20px;
            display: none;
        }

        #results { display: none; text-align: center; }
        .score-circle { font-size: 3rem; color: var(--accent); margin: 20px 0; }
    </style>
</head>
<body>

<div class="top-nav">
    <button class="btn-back" onclick="window.location.href='../index.html'">
        üè† Back to Levels
    </button>
</div>

<div id="quiz-wrapper">
    <div id="main-quiz">
        <div class="header">
            <h1 id="display-topic">TOPIC NAME</h1>
            <div id="timer">05:00</div>
        </div>

        <div class="progress-container"><div id="progress-bar"></div></div>

        <div class="question-box">
            <div id="q-text" class="question-text"></div>
            <div id="options" class="options-grid"></div>
        </div>

        <div id="feedback-panel">
            <div id="feedback-status" style="font-weight:bold"></div>
            <div id="feedback-desc" class="feedback-exp"></div>
        </div>

        <button id="next-btn" class="btn-nav" onclick="goNext()">NEXT QUESTION</button>
    </div>

    <div id="results">
        <h1>EXAM COMPLETE</h1>
        <div class="score-circle" id="final-score">0/0</div>
        <p id="rank-msg" style="margin-bottom: 20px;"></p>
        <p style="color: var(--accent); font-size: 0.9rem;">Redirecting to Performance Report...</p>
    </div>
</div>

<script src="../app.js"></script>

<script>
    const TOPIC_TITLE = "Gerund, Infinitive & Participle (Fill)"; 
    const TOPIC_KEY = "v-ing to-v blank"; 
    const TIME_LIMIT = 600; 
    const TOTAL_TO_SHOW = 20; 

    const pool = [
    { 
        q: "The manager suggested _____ the annual gala until the financial audits are completed.",
        o: ["to postpone", "postpone", "postponing", "postponed"],
        c: 2,
        e: "Verb Pattern. Kata kerja 'suggest' harus diikuti oleh Gerund (V-ing).",
        t: "üí° Suggest / Avoid / Enjoy / Admit + V-ing.",
        m: "‚ö†Ô∏è Jangan gunakan 'to-infinitive' setelah suggest."
    },
    { 
        q: "We are all looking forward to _____ the new research facility in Singapore next month.",
        o: ["visit", "visiting", "be visited", "to visit"],
        c: 1,
        e: "Fixed Expression. Dalam frasa 'look forward to', kata 'to' adalah preposisi, maka harus diikuti Gerund.",
        t: "üí° To di sini bukan partikel infinitive, tapi preposisi.",
        m: "‚ö†Ô∏è Salah satu jebakan paling umum; banyak yang memilih 'visit' (V1)."
    },
    { 
        q: "It is essential for the participants _____ the safety regulations before the experiment begins.",
        o: ["understand", "understanding", "to understand", "understood"],
        c: 2,
        e: "Adjective Pattern. Pola: It is + Adjective + for someone + to-Infinitive.",
        t: "üí° It is important/easy/essential + to-V1.",
        m: "‚ö†Ô∏è 'Understanding' hanya benar jika berfungsi sebagai subjek klausa."
    },
    { 
        q: "_____ by the lack of progress, the investors decided to withdraw their funding.",
        o: ["Frustrated", "Frustrating", "To frustrate", "They frustrated"],
        c: 0,
        e: "Past Participle as Cause. 'Frustrated' (terasa frustrasi/dipengaruhi) menjelaskan perasaan investor.",
        t: "üí° V-ed = Perasaan yang dialami. V-ing = Sifat yang menyebabkan perasaan.",
        m: "‚ö†Ô∏è 'Frustrating' berarti investor tersebut yang membuat orang lain frustrasi."
    },
    { 
        q: "The witness denied _____ any suspicious activity near the bank on the night of the robbery.",
        o: ["to see", "see", "having seen", "to have seen"],
        c: 2,
        e: "Verb Pattern + Perfect Gerund. 'Deny' diikuti Gerund. 'Having seen' menunjukkan aksi terjadi sebelum penyangkalan.",
        t: "üí° Deny + V-ing.",
        m: "‚ö†Ô∏è 'to see' tidak pernah digunakan setelah deny."
    },
    { 
        q: "The company encourages its employees _____ in the professional development workshops.",
        o: ["participate", "participating", "to participate", "to participating"],
        c: 2,
        e: "Verb + Object + Infinitive. Pola: Encourage + someone + to-V1.",
        t: "üí° Allow / Ask / Encourage / Want + Obj + to-V1.",
        m: "‚ö†Ô∏è Jangan gunakan V-ing setelah objek pada kata 'encourage'."
    },
    { 
        q: "I clearly remember _____ the door, but I cannot find my keys anywhere now.",
        o: ["to lock", "locking", "lock", "locked"],
        c: 1,
        e: "Meaning Change. 'Remember + V-ing' berarti ingat telah melakukan sesuatu di masa lalu.",
        t: "üí° Remember + V-ing = Memori masa lalu. Remember + To-V = Tugas yang harus dilakukan.",
        m: "‚ö†Ô∏è 'to lock' berarti ingat bahwa Anda *harus* mengunci (belum dilakukan)."
    },
    { 
        q: "_____ for several hours, the hikers were exhausted when they finally reached the summit.",
        o: ["Walking", "Having walked", "Walked", "To walk"],
        c: 1,
        e: "Perfect Participle. Digunakan untuk menunjukkan satu aksi selesai (jalan kaki) sebelum aksi lain (lelah/sampai).",
        t: "üí° Having + V3 = Setelah melakukan...",
        m: "‚ö†Ô∏è 'Walking' juga mungkin, tapi 'Having walked' lebih menekankan durasi yang telah selesai."
    },
    { 
        q: "The committee has no objection to _____ the proposal for further review.",
        o: ["submit", "submitting", "be submitted", "to submit"],
        c: 1,
        e: "Prepositional Phrase. 'Objection to' diikuti oleh Gerund karena 'to' adalah preposisi.",
        t: "üí° Object to / Be used to / Confess to + V-ing.",
        m: "‚ö†Ô∏è Sering tertukar dengan infinitive karena ada kata 'to'."
    },
    { 
        q: "She was seen _____ the building shortly after the alarm went off.",
        o: ["leave", "left", "leaving", "to leaving"],
        c: 2,
        e: "Verbs of Perception in Passive. Setelah 'be seen/heard', gunakan V-ing untuk menekankan aksi yang sedang berlangsung.",
        t: "üí° See / Hear + Obj + V-ing.",
        m: "‚ö†Ô∏è 'to leave' juga bisa digunakan secara gramatikal, tapi V-ing lebih umum untuk aksi spontan."
    },
    { 
        q: "It's no use _____ about the mistakes we made in the past.",
        o: ["to complain", "complain", "complaining", "complained"],
        c: 2,
        e: "Gerund Expression. Pola: 'It's no use / It's no good / It's worth' + V-ing.",
        t: "üí° Frasa-frasa ini selalu diikuti Gerund.",
        m: "‚ö†Ô∏è Hindari menggunakan 'to-infinitive' di sini."
    },
    { 
        q: "The professor made the students _____ the entire assignment before Friday.",
        o: ["rewrite", "to rewrite", "rewriting", "rewritten"],
        c: 0,
        e: "Causative Verb. 'Make' diikuti oleh Bare Infinitive (V1 tanpa 'to').",
        t: "üí° Make / Let / Have + Person + V1.",
        m: "‚ö†Ô∏è Jangan gunakan 'to' setelah 'make' dalam kalimat aktif."
    },
    { 
        q: "The doctor advised _____ more fruits and vegetables to improve her immune system.",
        o: ["eat", "to eat", "eating", "to eating"],
        c: 2,
        e: "Advise Pattern. Jika tidak ada objek orang setelah 'advise', gunakan Gerund. (Jika ada objek: advise her to eat).",
        t: "üí° Advise + V-ing (No Object) | Advise + Obj + To-V.",
        m: "‚ö†Ô∏è Hati-hati dengan kehadiran atau ketiadaan objek orang."
    },
    { 
        q: "He expects _____ by the end of this month, but the project is still behind schedule.",
        o: ["to finish", "finishing", "to be finished", "being finished"],
        c: 2,
        e: "Passive Infinitive. Proyek tersebut 'diselesaikan' (pasif), maka gunakan 'to be + V3'.",
        t: "üí° Expect + to-V1 (Active) | Expect + to be V3 (Passive).",
        m: "‚ö†Ô∏è Jika memilih 'to finish', berarti subjek 'He' yang menyelesaikan sesuatu, bukan proyeknya."
    },
    { 
        q: "_____ as a masterpiece of modern literature, the book has been translated into forty languages.",
        o: ["Regarded", "Regarding", "To regard", "Having regarded"],
        c: 0,
        e: "Passive Participle Clause. Buku tersebut 'dianggap' (pasif), maka mulai dengan V3.",
        t: "üí° V3 = Di... | V-ing = Men-...",
        m: "‚ö†Ô∏è 'Regarding' berarti buku tersebut yang menganggap sesuatu."
    },
    { 
        q: "You had better _____ a doctor if that cough persists for more than a week.",
        o: ["see", "to see", "seeing", "saw"],
        c: 0,
        e: "Modal Expression. 'Had better' diikuti oleh Bare Infinitive (V1 tanpa 'to').",
        t: "üí° Had better / Would rather + V1.",
        m: "‚ö†Ô∏è Meskipun ada kata 'had', ini bukan past tense."
    },
    { 
        q: "The government is considering _____ the tax rates for small businesses.",
        o: ["to lower", "lowering", "lower", "to lowering"],
        c: 1,
        e: "Verb Pattern. 'Consider' harus diikuti oleh Gerund.",
        t: "üí° Consider / Mind / Finish / Quit + V-ing.",
        m: "‚ö†Ô∏è 'to lower' adalah kesalahan umum bagi penutur non-asli."
    },
    { 
        q: "The results were very _____, as no one expected the underdog to win.",
        o: ["surprised", "surprising", "surprise", "to surprise"],
        c: 1,
        e: "Participle Adjective. Hasilnya bersifat 'mengejutkan' (penyebab), maka gunakan V-ing.",
        t: "üí° Surprising (Sifat benda) vs Surprised (Perasaan orang).",
        m: "‚ö†Ô∏è 'Surprised' hanya untuk subjek yang bisa merasakan emosi."
    },
    { 
        q: "He was too shocked _____ a single word when he heard the news.",
        o: ["speak", "speaking", "to speak", "to speaking"],
        c: 2,
        e: "Too... To pattern. Pola: Too + Adjective + to-Infinitive.",
        t: "üí° Terlalu... untuk... (bermakna negatif/tidak bisa).",
        m: "‚ö†Ô∏è Jangan gunakan V-ing setelah pola 'too + adj'."
    },
    { 
        q: "The primary purpose of this meeting is _____ a new marketing strategy.",
        o: ["develop", "to develop", "developing", "developed"],
        c: 1,
        e: "Subject Complement. Gunakan To-Infinitive untuk menjelaskan tujuan atau rencana.",
        t: "üí° My goal is to... / The purpose is to...",
        m: "‚ö†Ô∏è 'developing' bisa benar secara tata bahasa, tapi 'to develop' lebih umum untuk menyatakan tujuan."
    }
];

    let currentQuestions = [];
    let currentIdx = 0;
    let score = 0;
    let timer;
    let timeLeft = TIME_LIMIT;
    let answered = false;

    function init() {
        document.getElementById('display-topic').innerText = TOPIC_TITLE;
        currentQuestions = pool.sort(() => 0.5 - Math.random()).slice(0, TOTAL_TO_SHOW);
        startTimer();
        showQuestion();
    }

    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if(timeLeft <= 0) finish();
        }, 1000);
    }

    function showQuestion() {
        answered = false;
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-panel').style.display = 'none';
        const q = currentQuestions[currentIdx];
        
        document.getElementById('progress-bar').style.width = (currentIdx / TOTAL_TO_SHOW * 100) + "%";
        document.getElementById('q-text').innerText = `${currentIdx + 1}. ${q.q}`;
        
        const opts = document.getElementById('options');
        opts.innerHTML = '';
        q.o.forEach((o, i) => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = o;
            b.onclick = () => check(i, b);
            opts.appendChild(b);
        });
    }

    function check(idx, btn) {
        if(answered) return;
        answered = true;
        const q = currentQuestions[currentIdx];
        const all = document.querySelectorAll('.opt-btn');

        if(idx === q.c) {
            score++;
            btn.classList.add('correct');
            showFeedback("CORRECT", q.e, q.t, q.m);
        } else {
            btn.classList.add('wrong');
            all[q.c].classList.add('correct');
            showFeedback("INCORRECT", q.e, q.t, q.m);
        }
        document.getElementById('next-btn').style.display = 'block';
    }

    function showFeedback(status, text, tip, misc) {
        const p = document.getElementById('feedback-panel');
        document.getElementById('feedback-status').innerText = status;
        document.getElementById('feedback-status').style.color = (status === "CORRECT") ? "var(--success)" : "var(--error)";
        document.getElementById('feedback-desc').innerHTML = `${text}<br><br><span style="color:#58a6ff">${tip}</span><br><span style="color:#ffa657">${misc}</span>`;
        p.style.display = 'block';
    }

    function goNext() {
        currentIdx++;
        if(currentIdx < TOTAL_TO_SHOW) showQuestion();
        else finish();
    }

    function finish() {
        clearInterval(timer);
        document.getElementById('main-quiz').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}/${TOTAL_TO_SHOW}`;
        
        let msg = "";
        let grade = "";
        let percent = Math.round((score / TOTAL_TO_SHOW) * 100);

        if(percent >= 85) { msg = "Excellent Work! Mastery Achieved."; grade = "A"; }
        else if(percent >= 70) { msg = "Good Job! A bit more practice and you'll be perfect."; grade = "B"; }
        else { msg = "Keep Practicing. Review the explanations to improve."; grade = "C"; }
        
        document.getElementById('rank-msg').innerText = msg;

        setTimeout(() => {
            if (typeof finishQuiz === "function") {
                finishQuiz(percent, score, TOTAL_TO_SHOW, grade, msg, TOPIC_KEY);
            }
        }, 3000); 
    }

    init();
</script>
</body>
</html>