<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise - Grammar Peace</title>
    <style>
        :root {
            --bg-color: #0a0e14;
            --card-bg: #161b22;
            --text-main: #c9d1d9;
            --accent: #58a6ff;
            --success: #2ea043;
            --error: #da3633;
            --border: #30363d;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        .top-nav {
            width: 100%;
            max-width: 750px;
            margin-bottom: 15px;
            display: flex;
            justify-content: flex-start;
        }

        .btn-back {
            background: var(--card-bg);
            color: var(--text-main);
            border: 1px solid var(--border);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .btn-back:hover { background: #30363d; border-color: var(--accent); }

        #quiz-wrapper {
            background: var(--card-bg);
            max-width: 750px;
            width: 100%;
            padding: 35px;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .header h1 { font-size: 1.4rem; color: var(--accent); margin: 0; text-transform: uppercase; }
        #timer { font-family: monospace; font-size: 1.2rem; color: #ffa657; }

        .progress-container { height: 4px; background: #21262d; margin-bottom: 25px; }
        #progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        .question-box { margin-bottom: 30px; }
        .question-text { font-size: 1.2rem; margin-bottom: 20px; line-height: 1.5; }

        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }

        .opt-btn {
            background: #21262d;
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 15px 20px;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: 0.2s;
        }

        .opt-btn:hover:not(:disabled) { background: #30363d; border-color: #8b949e; }
        .opt-btn.correct { background: var(--success) !important; color: white; }
        .opt-btn.wrong { background: var(--error) !important; color: white; }

        #feedback-panel {
            margin-top: 20px;
            padding: 20px;
            border-radius: 6px;
            background: #0d1117;
            border-left: 4px solid var(--accent);
            display: none;
        }

        .feedback-exp { font-size: 0.95rem; color: #8b949e; margin-top: 8px; }

        .btn-nav {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            float: right;
            margin-top: 20px;
            display: none;
        }

        #results { display: none; text-align: center; }
        .score-circle { font-size: 3rem; color: var(--accent); margin: 20px 0; }
    </style>
</head>
<body>

<div class="top-nav">
    <button class="btn-back" onclick="window.location.href='../index.html'">
        üè† Back to Levels
    </button>
</div>

<div id="quiz-wrapper">
    <div id="main-quiz">
        <div class="header">
            <!-- EDIT DI SINI: JUDUL TOPIK -->
            <h1 id="display-topic">TOPIC NAME</h1>
            <div id="timer">05:00</div>
        </div>

        <div class="progress-container"><div id="progress-bar"></div></div>

        <div class="question-box">
            <div id="q-text" class="question-text"></div>
            <div id="options" class="options-grid"></div>
        </div>

        <div id="feedback-panel">
            <div id="feedback-status" style="font-weight:bold"></div>
            <div id="feedback-desc" class="feedback-exp"></div>
        </div>

        <button id="next-btn" class="btn-nav" onclick="goNext()">NEXT QUESTION</button>
    </div>

    <div id="results">
        <h1>EXAM COMPLETE</h1>
        <div class="score-circle" id="final-score">0/0</div>
        <p id="rank-msg" style="margin-bottom: 20px;"></p>
        <p style="color: var(--accent); font-size: 0.9rem;">Redirecting to Performance Report...</p>
    </div>
</div>

<script src="../app.js"></script>

<script>
    /* ============================================================
       BAGIAN 1: KONFIGURASI SOAL (EDIT DI SINI)
       ============================================================ */
    
    const TOPIC_TITLE = "Mastering Language"; // Ganti Judul
    const TOPIC_KEY = "language fill"; // HARUS SAMA dengan nama di TOPICS app.js
    const TIME_LIMIT = 300; // Dalam detik (300 = 5 menit)
    const TOTAL_TO_SHOW = 20; // Jumlah soal yang ditampilkan (misal dari 20 soal, ambil 10 acak)

    const pool = [
    { 
        q: "Identify the type: 'under the table'", 
        o: ["Sentence", "Phrase", "Clause", "Fragment"], 
        c: 1, 
        e: "'Under the table' is a phrase because it lacks a subject and verb.",
        t: "üí° Phrase = group of words WITHOUT subject + verb working together.",
        m: "‚ö†Ô∏è Students often confuse phrases with clauses because both are groups of words."
    },
    { 
        q: "Which one is a complete sentence?", 
        o: ["Running quickly", "Because he was late", "She enjoys reading books", "In the morning"], 
        c: 2, 
        e: "'She enjoys reading books' has a subject (She) and a verb (enjoys) and expresses a complete thought.",
        t: "üí° Complete sentence = Subject + Verb + Complete thought.",
        m: "‚ö†Ô∏è Many forget that a sentence must express a COMPLETE thought, not just have S+V."
    },
    { 
        q: "'When the bell rings' is a/an _______", 
        o: ["Independent clause", "Dependent clause", "Phrase", "Sentence"], 
        c: 1, 
        e: "It has subject (bell) and verb (rings) but cannot stand alone because of 'when'.",
        t: "üí° Dependent clause = Has S+V but starts with subordinator (when, if, because, etc.)",
        m: "‚ö†Ô∏è Students think anything with S+V is a sentence, but dependent clauses need main clauses."
    },
    { 
        q: "Identify: 'The book on the shelf is mine.'", 
        o: ["Simple phrase", "Complex sentence", "Simple sentence", "Compound sentence"], 
        c: 2, 
        e: "It's a simple sentence with one independent clause. 'On the shelf' is just a prepositional phrase.",
        t: "üí° Simple sentence = ONE independent clause (even if it has phrases inside).",
        m: "‚ö†Ô∏è Prepositional phrases don't make a sentence complex."
    },
    { 
        q: "'After dinner' is a _______", 
        o: ["Clause", "Sentence", "Phrase", "Fragment only"], 
        c: 2, 
        e: "It's a phrase (specifically a prepositional phrase) - no subject or verb.",
        t: "üí° After/before/during + noun = prepositional phrase.",
        m: "‚ö†Ô∏è Don't confuse 'after dinner' (phrase) with 'after he ate dinner' (clause)."
    },
    { 
        q: "Which is an independent clause?", 
        o: ["Although it was raining", "The sky is blue", "Walking in the park", "Very quickly"], 
        c: 1, 
        e: "'The sky is blue' can stand alone as a complete sentence with S+V.",
        t: "üí° Independent clause = Can stand ALONE as a sentence.",
        m: "‚ö†Ô∏è 'Although it was raining' has S+V but can't stand alone (dependent)."
    },
    { 
        q: "'She smiled because she was happy' contains _______ clause(s).", 
        o: ["One independent", "One dependent", "Two independent", "One independent and one dependent"], 
        c: 3, 
        e: "'She smiled' = independent; 'because she was happy' = dependent.",
        t: "üí° Because/since/as/if = markers of dependent clauses.",
        m: "‚ö†Ô∏è Students count clauses wrong - count how many S+V pairs first."
    },
    { 
        q: "Identify: 'to sing beautifully'", 
        o: ["Infinitive phrase", "Gerund phrase", "Clause", "Sentence"], 
        c: 0, 
        e: "It's an infinitive phrase starting with 'to + verb'.",
        t: "üí° Infinitive phrase = to + base verb (+ other words).",
        m: "‚ö†Ô∏è Infinitives are NOT verbs in a sentence - they're verbals (act as nouns/adj/adv)."
    },
    { 
        q: "'Running every morning keeps me healthy' - 'Running every morning' is a _______", 
        o: ["Clause", "Gerund phrase", "Infinitive phrase", "Sentence"], 
        c: 1, 
        e: "It's a gerund phrase (verb+ing functioning as a noun/subject).",
        t: "üí° Gerund phrase = -ing verb form used as a noun.",
        m: "‚ö†Ô∏è Don't confuse with present participle in continuous tenses."
    },
    { 
        q: "How many clauses? 'I know that you are right.'", 
        o: ["One", "Two", "Three", "Zero"], 
        c: 1, 
        e: "Two clauses: 'I know' (independent) and 'that you are right' (dependent/noun clause).",
        t: "üí° Count S+V pairs to find number of clauses.",
        m: "‚ö†Ô∏è 'That' often introduces noun clauses - don't ignore it."
    },
    { 
        q: "'With great power' is a _______", 
        o: ["Sentence", "Independent clause", "Prepositional phrase", "Dependent clause"], 
        c: 2, 
        e: "It's a prepositional phrase (preposition + object).",
        t: "üí° Preposition + noun/pronoun = prepositional phrase.",
        m: "‚ö†Ô∏è Phrases NEVER have both subject and verb."
    },
    { 
        q: "Which is NOT a sentence?", 
        o: ["Stop!", "She runs.", "Very interesting book.", "It rained."], 
        c: 2, 
        e: "'Very interesting book' has no verb - it's a noun phrase.",
        t: "üí° Even one-word commands like 'Stop!' are sentences (implied subject 'you').",
        m: "‚ö†Ô∏è Students forget that commands are complete sentences."
    },
    { 
        q: "'Unless you study hard' is a _______", 
        o: ["Complete sentence", "Independent clause", "Dependent clause", "Phrase"], 
        c: 2, 
        e: "It has S+V but starts with 'unless' (subordinator), so it's dependent.",
        t: "üí° Unless/until/while = subordinators that create dependent clauses.",
        m: "‚ö†Ô∏è Dependent clauses NEED an independent clause to complete meaning."
    },
    { 
        q: "'The man wearing a hat' is a _______", 
        o: ["Sentence", "Noun phrase", "Dependent clause", "Independent clause"], 
        c: 1, 
        e: "It's a noun phrase. 'Wearing' is a participle (not a main verb).",
        t: "üí° Participles (-ing, -ed) in phrases are NOT main verbs.",
        m: "‚ö†Ô∏è 'Wearing' looks like a verb but it's actually describing 'man' (adjective function)."
    },
    { 
        q: "'I like pizza and I like pasta' is a _______ sentence.", 
        o: ["Simple", "Compound", "Complex", "Compound-complex"], 
        c: 1, 
        e: "Two independent clauses joined by 'and' = compound sentence.",
        t: "üí° Compound = 2+ independent clauses (often with FANBOYS).",
        m: "‚ö†Ô∏è Don't confuse compound sentences with simple sentences that have compound subjects/verbs."
    },
    { 
        q: "'Although tired, she continued working' - how many clauses?", 
        o: ["Zero", "One", "Two", "Three"], 
        c: 1, 
        e: "One clause: 'she continued working'. 'Although tired' is a reduced clause/phrase.",
        t: "üí° Reduced clauses lose their subject+verb but keep the subordinator.",
        m: "‚ö†Ô∏è 'Although tired' = reduced form of 'although she was tired'."
    },
    { 
        q: "'In the classroom, students are learning' - 'In the classroom' is a _______", 
        o: ["Clause", "Phrase", "Sentence", "Subject"], 
        c: 1, 
        e: "It's a prepositional phrase acting as an adverb (tells WHERE).",
        t: "üí° Phrases at the start of sentences are often prepositional or participial.",
        m: "‚ö†Ô∏è Starting position doesn't change that it's a phrase, not a clause."
    },
    { 
        q: "Which contains a noun clause?", 
        o: ["I think he is smart", "What you said is true", "The book that I read", "Walking slowly"], 
        c: 1, 
        e: "'What you said' is a noun clause acting as the subject.",
        t: "üí° Noun clauses often start with: that, what, who, where, when, how, whether.",
        m: "‚ö†Ô∏è 'What' here is a clause marker, not just a question word."
    },
    { 
        q: "'Before leaving the house' is a _______", 
        o: ["Dependent clause", "Independent clause", "Phrase", "Sentence"], 
        c: 2, 
        e: "It's a phrase (no subject). 'Leaving' is a gerund, not a main verb.",
        t: "üí° Before + -ing form = prepositional phrase with gerund.",
        m: "‚ö†Ô∏è Compare: 'before leaving' (phrase) vs 'before he left' (clause)."
    },
    { 
        q: "'When I arrive, I will call you' is a _______ sentence.", 
        o: ["Simple", "Compound", "Complex", "Fragment"], 
        c: 2, 
        e: "It has one dependent clause (When I arrive) + one independent clause (I will call you).",
        t: "üí° Complex sentence = Independent + Dependent clause(s).",
        m: "‚ö†Ô∏è Don't confuse with compound (which has 2+ independent clauses)."
    }
];

    /* ============================================================
       BAGIAN 2: LOGIKA SISTEM (JANGAN DIEDIT KECUALI PAHAM)
       ============================================================ */
    
    let currentQuestions = [];
    let currentIdx = 0;
    let score = 0;
    let timer;
    let timeLeft = TIME_LIMIT;
    let answered = false;

    function init() {
        document.getElementById('display-topic').innerText = TOPIC_TITLE;
        // Acak soal dan ambil sebanyak TOTAL_TO_SHOW
        currentQuestions = pool.sort(() => 0.5 - Math.random()).slice(0, TOTAL_TO_SHOW);
        startTimer();
        showQuestion();
    }

    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if(timeLeft <= 0) finish();
        }, 1000);
    }

    function showQuestion() {
        answered = false;
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-panel').style.display = 'none';
        const q = currentQuestions[currentIdx];
        
        document.getElementById('progress-bar').style.width = (currentIdx / TOTAL_TO_SHOW * 100) + "%";
        document.getElementById('q-text').innerText = `${currentIdx + 1}. ${q.q}`;
        
        const opts = document.getElementById('options');
        opts.innerHTML = '';
        q.o.forEach((o, i) => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = o;
            b.onclick = () => check(i, b);
            opts.appendChild(b);
        });
    }

    function check(idx, btn) {
        if(answered) return;
        answered = true;
        const q = currentQuestions[currentIdx];
        const all = document.querySelectorAll('.opt-btn');

        if(idx === q.c) {
            score++;
            btn.classList.add('correct');
            showFeedback("CORRECT", q.e);
        } else {
            btn.classList.add('wrong');
            all[q.c].classList.add('correct');
            showFeedback("INCORRECT", q.e);
        }
        document.getElementById('next-btn').style.display = 'block';
    }

    function showFeedback(status, text) {
        const p = document.getElementById('feedback-panel');
        document.getElementById('feedback-status').innerText = status;
        document.getElementById('feedback-status').style.color = (status === "CORRECT") ? "var(--success)" : "var(--error)";
        document.getElementById('feedback-desc').innerText = text;
        p.style.display = 'block';
    }

    function goNext() {
        currentIdx++;
        if(currentIdx < TOTAL_TO_SHOW) showQuestion();
        else finish();
    }

    function finish() {
        clearInterval(timer);
        document.getElementById('main-quiz').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}/${TOTAL_TO_SHOW}`;
        
        let msg = "";
        let grade = "";
        let percent = Math.round((score / TOTAL_TO_SHOW) * 100);

        if(percent >= 85) { msg = "Excellent Work! Mastery Achieved."; grade = "A"; }
        else if(percent >= 70) { msg = "Good Job! A bit more practice and you'll be perfect."; grade = "B"; }
        else { msg = "Keep Practicing. Review the explanations to improve."; grade = "C"; }
        
        document.getElementById('rank-msg').innerText = msg;

        setTimeout(() => {
            if (typeof finishQuiz === "function") {
                finishQuiz(percent, score, TOTAL_TO_SHOW, grade, msg, TOPIC_KEY);
            }
        }, 3000); 
    }

    init();
</script>
</body>
</html>