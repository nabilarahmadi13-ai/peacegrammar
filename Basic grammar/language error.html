<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise - Grammar Peace</title>
    <style>
        :root {
            --bg-color: #0a0e14;
            --card-bg: #161b22;
            --text-main: #c9d1d9;
            --accent: #58a6ff;
            --success: #2ea043;
            --error: #da3633;
            --border: #30363d;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        .top-nav {
            width: 100%;
            max-width: 750px;
            margin-bottom: 15px;
            display: flex;
            justify-content: flex-start;
        }

        .btn-back {
            background: var(--card-bg);
            color: var(--text-main);
            border: 1px solid var(--border);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .btn-back:hover { background: #30363d; border-color: var(--accent); }

        #quiz-wrapper {
            background: var(--card-bg);
            max-width: 750px;
            width: 100%;
            padding: 35px;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .header h1 { font-size: 1.4rem; color: var(--accent); margin: 0; text-transform: uppercase; }
        #timer { font-family: monospace; font-size: 1.2rem; color: #ffa657; }

        .progress-container { height: 4px; background: #21262d; margin-bottom: 25px; }
        #progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        .question-box { margin-bottom: 30px; }
        .question-text { font-size: 1.2rem; margin-bottom: 20px; line-height: 1.5; }

        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }

        .opt-btn {
            background: #21262d;
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 15px 20px;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: 0.2s;
        }

        .opt-btn:hover:not(:disabled) { background: #30363d; border-color: #8b949e; }
        .opt-btn.correct { background: var(--success) !important; color: white; }
        .opt-btn.wrong { background: var(--error) !important; color: white; }

        #feedback-panel {
            margin-top: 20px;
            padding: 20px;
            border-radius: 6px;
            background: #0d1117;
            border-left: 4px solid var(--accent);
            display: none;
        }

        .feedback-exp { font-size: 0.95rem; color: #8b949e; margin-top: 8px; }

        .btn-nav {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            float: right;
            margin-top: 20px;
            display: none;
        }

        #results { display: none; text-align: center; }
        .score-circle { font-size: 3rem; color: var(--accent); margin: 20px 0; }
    </style>
</head>
<body>

<div class="top-nav">
    <button class="btn-back" onclick="window.location.href='../index.html'">
        üè† Back to Levels
    </button>
</div>

<div id="quiz-wrapper">
    <div id="main-quiz">
        <div class="header">
            <!-- EDIT DI SINI: JUDUL TOPIK -->
            <h1 id="display-topic">TOPIC NAME</h1>
            <div id="timer">05:00</div>
        </div>

        <div class="progress-container"><div id="progress-bar"></div></div>

        <div class="question-box">
            <div id="q-text" class="question-text"></div>
            <div id="options" class="options-grid"></div>
        </div>

        <div id="feedback-panel">
            <div id="feedback-status" style="font-weight:bold"></div>
            <div id="feedback-desc" class="feedback-exp"></div>
        </div>

        <button id="next-btn" class="btn-nav" onclick="goNext()">NEXT QUESTION</button>
    </div>

    <div id="results">
        <h1>EXAM COMPLETE</h1>
        <div class="score-circle" id="final-score">0/0</div>
        <p id="rank-msg" style="margin-bottom: 20px;"></p>
        <p style="color: var(--accent); font-size: 0.9rem;">Redirecting to Performance Report...</p>
    </div>
</div>

<script src="../app.js"></script>

<script>
    /* ============================================================
       BAGIAN 1: KONFIGURASI SOAL (EDIT DI SINI)
       ============================================================ */
    
    const TOPIC_TITLE = "Mastering Language"; // Ganti Judul
    const TOPIC_KEY = "language error"; // HARUS SAMA dengan nama di TOPICS app.js
    const TIME_LIMIT = 300; // Dalam detik (300 = 5 menit)
    const TOTAL_TO_SHOW = 20; // Jumlah soal yang ditampilkan (misal dari 20 soal, ambil 10 acak)

    const pool = [
    { 
        q: "Because I was tired and went to bed early.",
        o: ["Because", "was tired", "went to bed", "No Error"],
        c: 0,
        e: "'Because' makes this a dependent clause fragment. Remove 'Because' or add an independent clause.",
        t: "üí° Starting with 'because' alone creates a fragment - needs main clause.",
        m: "‚ö†Ô∏è Students write fragments by starting with subordinators (because, although, when)."
    },
    { 
        q: "She enjoys reading books, is a good hobby.",
        o: ["She enjoys", "reading books", "is a good hobby", "No Error"],
        c: 2,
        e: "This creates a comma splice. Should be: 'She enjoys reading books. It is a good hobby.'",
        t: "üí° Two complete thoughts need a period, semicolon, or conjunction - not just a comma.",
        m: "‚ö†Ô∏è Comma splices are very common - can't join two sentences with only a comma."
    },
    { 
        q: "The teacher who teaches us math very experienced.",
        o: ["who teaches us", "math", "very experienced", "No Error"],
        c: 2,
        e: "'Very experienced' needs 'is' before it. Should be 'is very experienced'.",
        t: "üí° Every sentence needs a main verb. 'Teaches' is in the relative clause, not main verb.",
        m: "‚ö†Ô∏è Relative clauses (who/which/that) don't provide the main verb."
    },
    { 
        q: "Walking in the park. I saw a beautiful bird.",
        o: ["Walking in the park", "I saw", "a beautiful bird", "No Error"],
        c: 0,
        e: "'Walking in the park' is a fragment. Should be joined: 'Walking in the park, I saw...'",
        t: "üí° Participial phrases (-ing at start) must attach to main clause with comma.",
        m: "‚ö†Ô∏è Don't separate participial phrases with a period - they're not complete sentences."
    },
    { 
        q: "If you come early. We can have breakfast together.",
        o: ["If you come early", "We can have", "breakfast together", "No Error"],
        c: 0,
        e: "'If you come early' is a dependent clause. Should use comma, not period: 'If you come early, we...'",
        t: "üí° Dependent clauses starting sentences need comma to attach to main clause.",
        m: "‚ö†Ô∏è Never put a period after a dependent clause at the start."
    },
    { 
        q: "The book on the table it is mine.",
        o: ["The book on the table", "it is", "mine", "No Error"],
        c: 1,
        e: "'It' is unnecessary. Should be: 'The book on the table is mine.' (remove 'it')",
        t: "üí° Don't use double subjects. 'The book' is already the subject.",
        m: "‚ö†Ô∏è Common error in some languages - adding 'it' after a noun phrase subject."
    },
    { 
        q: "I like swimming and to run in the morning.",
        o: ["I like", "swimming and to run", "in the morning", "No Error"],
        c: 1,
        e: "Parallel structure error. Should be: 'swimming and running' OR 'to swim and to run'.",
        t: "üí° Items in a list must be in the same grammatical form (parallel structure).",
        m: "‚ö†Ô∏è Mixing gerund and infinitive breaks parallelism."
    },
    { 
        q: "Although he is young but he is very talented.",
        o: ["Although he is young", "but", "he is very talented", "No Error"],
        c: 1,
        e: "Can't use 'although' and 'but' together. Choose one: 'Although he is young, he is...' OR 'He is young but...'",
        t: "üí° Although/Though = subordinator. But = coordinator. Never use both!",
        m: "‚ö†Ô∏è Very common error - using two contrast words together."
    },
    { 
        q: "My sister she works in a hospital.",
        o: ["My sister", "she works", "in a hospital", "No Error"],
        c: 1,
        e: "'She' is redundant. Should be: 'My sister works in a hospital.'",
        t: "üí° One subject per clause. Don't repeat with pronoun.",
        m: "‚ö†Ô∏è Some languages allow subject pronouns after nouns, but English doesn't."
    },
    { 
        q: "He studies hard, therefore he gets good grades.",
        o: ["He studies hard", "therefore", "he gets good grades", "No Error"],
        c: 1,
        e: "Needs semicolon before 'therefore': 'He studies hard; therefore, he gets...'",
        t: "üí° Therefore/however/moreover = conjunctive adverbs, need semicolon (;) before.",
        m: "‚ö†Ô∏è These aren't coordinators like FANBOYS - they need stronger punctuation."
    },
    { 
        q: "The students which passed the exam celebrated.",
        o: ["The students", "which", "passed the exam", "No Error"],
        c: 1,
        e: "'Which' is for things. Use 'who' for people: 'The students who passed...'",
        t: "üí° Who = people, Which = things/animals, That = both.",
        m: "‚ö†Ô∏è Don't use 'which' for people."
    },
    { 
        q: "Running quickly to catch the bus.",
        o: ["Running quickly", "to catch", "the bus", "No Error"],
        c: 0,
        e: "This is a fragment (no subject or main verb). Need: 'I was running quickly to catch the bus.'",
        t: "üí° Participial phrases alone = fragments. Add subject + helping verb.",
        m: "‚ö†Ô∏è '-ing' forms alone don't make complete verbs."
    },
    { 
        q: "Because of he was sick, he stayed home.",
        o: ["Because of", "he was sick", "stayed home", "No Error"],
        c: 0,
        e: "'Because of' takes nouns, not clauses. Use 'Because' (+ clause) or 'Because of his sickness' (+ noun).",
        t: "üí° Because + clause (S+V). Because of + noun phrase.",
        m: "‚ö†Ô∏è Don't mix up 'because' and 'because of'."
    },
    { 
        q: "The reason why I left is because I was tired.",
        o: ["The reason why", "I left is", "because I was tired", "No Error"],
        c: 2,
        e: "Redundant. Should be: 'The reason I left is that I was tired' OR 'I left because I was tired.'",
        t: "üí° 'The reason... is that' (not 'is because').",
        m: "‚ö†Ô∏è 'Reason' and 'because' are redundant together."
    },
    { 
        q: "Despite it was raining, we went out.",
        o: ["Despite", "it was raining", "we went out", "No Error"],
        c: 0,
        e: "'Despite' takes noun phrases, not clauses. Use 'Although/Though it was raining' OR 'Despite the rain'.",
        t: "üí° Despite/In spite of + noun. Although/Though + clause.",
        m: "‚ö†Ô∏è Don't use 'despite' with clauses - it needs noun phrases."
    },
    { 
        q: "I want that you come to the party.",
        o: ["I want", "that you come", "to the party", "No Error"],
        c: 1,
        e: "Should be: 'I want you to come' (infinitive) not 'that you come'.",
        t: "üí° Want + object + to-infinitive (not 'that' clause).",
        m: "‚ö†Ô∏è Some verbs (want, need, would like) take infinitives, not 'that' clauses."
    },
    { 
        q: "She suggested me to apply for the job.",
        o: ["She suggested", "me to apply", "for the job", "No Error"],
        c: 1,
        e: "Should be: 'She suggested that I apply' OR 'She advised me to apply' (but NOT 'suggested me to').",
        t: "üí° Suggest + that clause OR suggest + gerund. Advise + object + infinitive.",
        m: "‚ö†Ô∏è 'Suggest' doesn't take object + infinitive structure."
    },
    { 
        q: "One of my friends are coming to visit.",
        o: ["One of my friends", "are", "coming to visit", "No Error"],
        c: 1,
        e: "'Are' should be 'is'. Subject is 'One' (singular), not 'friends'.",
        t: "üí° 'One of' takes singular verb (the subject is 'one', not the plural noun after 'of').",
        m: "‚ö†Ô∏è Don't be fooled by the plural noun - focus on 'one'."
    },
    { 
        q: "What I need is some rest and to sleep early.",
        o: ["What I need", "is", "some rest and to sleep early", "No Error"],
        c: 2,
        e: "Parallel structure error. Should be: 'some rest and early sleep' OR 'to rest and to sleep early'.",
        t: "üí° Keep parallel structure in lists - same grammatical form.",
        m: "‚ö†Ô∏è Mixing noun and infinitive breaks parallelism."
    },
    { 
        q: "The news are very surprising today.",
        o: ["The news", "are", "very surprising", "No Error"],
        c: 1,
        e: "'News' is uncountable/singular. Should be: 'The news is very surprising.'",
        t: "üí° News, information, advice = uncountable, always singular.",
        m: "‚ö†Ô∏è 'News' looks plural (ends in -s) but it's singular."
    }
];

    /* ============================================================
       BAGIAN 2: LOGIKA SISTEM (JANGAN DIEDIT KECUALI PAHAM)
       ============================================================ */
    
    let currentQuestions = [];
    let currentIdx = 0;
    let score = 0;
    let timer;
    let timeLeft = TIME_LIMIT;
    let answered = false;

    function init() {
        document.getElementById('display-topic').innerText = TOPIC_TITLE;
        // Acak soal dan ambil sebanyak TOTAL_TO_SHOW
        currentQuestions = pool.sort(() => 0.5 - Math.random()).slice(0, TOTAL_TO_SHOW);
        startTimer();
        showQuestion();
    }

    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if(timeLeft <= 0) finish();
        }, 1000);
    }

    function showQuestion() {
        answered = false;
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-panel').style.display = 'none';
        const q = currentQuestions[currentIdx];
        
        document.getElementById('progress-bar').style.width = (currentIdx / TOTAL_TO_SHOW * 100) + "%";
        document.getElementById('q-text').innerText = `${currentIdx + 1}. ${q.q}`;
        
        const opts = document.getElementById('options');
        opts.innerHTML = '';
        q.o.forEach((o, i) => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = o;
            b.onclick = () => check(i, b);
            opts.appendChild(b);
        });
    }

    function check(idx, btn) {
        if(answered) return;
        answered = true;
        const q = currentQuestions[currentIdx];
        const all = document.querySelectorAll('.opt-btn');

        if(idx === q.c) {
            score++;
            btn.classList.add('correct');
            showFeedback("CORRECT", q.e);
        } else {
            btn.classList.add('wrong');
            all[q.c].classList.add('correct');
            showFeedback("INCORRECT", q.e);
        }
        document.getElementById('next-btn').style.display = 'block';
    }

    function showFeedback(status, text) {
        const p = document.getElementById('feedback-panel');
        document.getElementById('feedback-status').innerText = status;
        document.getElementById('feedback-status').style.color = (status === "CORRECT") ? "var(--success)" : "var(--error)";
        document.getElementById('feedback-desc').innerText = text;
        p.style.display = 'block';
    }

    function goNext() {
        currentIdx++;
        if(currentIdx < TOTAL_TO_SHOW) showQuestion();
        else finish();
    }

    function finish() {
        clearInterval(timer);
        document.getElementById('main-quiz').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}/${TOTAL_TO_SHOW}`;
        
        let msg = "";
        let grade = "";
        let percent = Math.round((score / TOTAL_TO_SHOW) * 100);

        if(percent >= 85) { msg = "Excellent Work! Mastery Achieved."; grade = "A"; }
        else if(percent >= 70) { msg = "Good Job! A bit more practice and you'll be perfect."; grade = "B"; }
        else { msg = "Keep Practicing. Review the explanations to improve."; grade = "C"; }
        
        document.getElementById('rank-msg').innerText = msg;

        setTimeout(() => {
            if (typeof finishQuiz === "function") {
                finishQuiz(percent, score, TOTAL_TO_SHOW, grade, msg, TOPIC_KEY);
            }
        }, 3000); 
    }

    init();
</script>
</body>
</html>